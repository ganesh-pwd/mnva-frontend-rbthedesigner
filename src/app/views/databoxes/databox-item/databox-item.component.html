<br />
<div *ngIf="data?.databox_name && paginatedData">
  <div class="header-row m-333" fxLayout="row" fxLayoutWrap="wrap">
    <div fxLayout="column" fxFlex="100" fxFlex.gt-md="100" id="head">
      <img src="assets/images/icon-databox.png" />
      <h1 class="mat-h1">
        {{ data?.databox_name }}
        <small> 
          <mat-icon (click)="modifyDataboxDialog('Edit Databox Name', 'Databox Name', true)"> 
          edit</mat-icon>      
          <span class="main-route"> 
            <a routerLink="/databoxes/">Databoxes </a> 
          </span><span>/ {{ data?.databox_name }}</span>
        </small>
      </h1>
    </div>
  </div>

  <!-- Upper Menu -->
  <div
    class="m-333"
    fxLayout="row"
    fxLayoutWrap="wrap"
    style="border-bottom: 1px solid gray;"
  >
    <button
      mat-raised-button
      class="mb-05"
      color="primary"
      routerLink="/databoxes/edit-query/{{ data?._id }}"
    >
      Edit Query
    </button>
    <button
      mat-raised-button
      class="mb-05 mat-bg-success"
      routerLink="/databoxes/settings/connect/{{ data?._id }}"
    >
      Connect Your Data
    </button>

    <span fxFlex></span>
    <div class="mr-1 ">
      <app-slide-toggle [id]="id" *ngIf="data._id"></app-slide-toggle>
    </div>
  </div>
</div>

<!-- Tabs -->
<mat-tab-group dynamicHeight [selectedIndex]="selectedTab">
    <!-- Results -->
    <mat-tab label="Results">
      <!-- Line Chart -->
      <div fxLayout="row" fxLayoutWrap="wrap" [hidden]="data?.first_create">
        <div fxFlex="100" fxFlex.gt-sm="100">
          <mat-card class="p-0 fixed-height">
            <mat-card-content>
              <!-- Line Chart -->
              <canvas 
              baseChart
              class="chart"
              [datasets]="lineChartData"
              [labels]="lineChartLabels"
              [options]="lineChartOptions"
              [colors]="chartColors"
              [legend]="lineChartLegend"
              [chartType]="lineChartType"></canvas>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      
      <!-- First Table -->
      <div [hidden]="data?.first_create">
        
          <mat-card class="p-0" fxLayout="row" fxLayoutWrap="wrap" style="height: 100% !important; overflow: hidden !important;">
            
            <mat-card-content class="table-mat-card-content" fxLayout="row" fxLayoutWrap="wrap"  
              style="overflow: hidden !important; width: 100% !important; height: 100% !important;">
              
              <div fxLayout="row" fxLayout.lt-sm="column" fxFlex="100" fxFlex.gt-md="100" 
              class="page-search mat-bg-gray">
                <div>
                  <p>
                      <b>Mentions:</b> {{mentions?.mentions}}&nbsp;&nbsp;|&nbsp;&nbsp;<b>Mentions per day:</b> {{mentions?.mentions_per_day}}
                  </p>
                </div>
                <span fxFlex></span>
                <div>
                  <!-- Download CSV -->
                  <a class="mr-1 fz-12 head-mentions" 
                  (click)="downloadCSV()">
                  <mat-icon class="download">file_download</mat-icon><b>Download Data</b></a>

                  <!-- Add Suggestion -->
                  <a class="head-mentions fz-12" *ngIf="mentions?.mentions && data?.datasource !== 'Twitter'"
                  (click)="openAddSuggestion()"><b>Not Finding a Result?</b></a>
                </div>
              </div>
          
              <div [@animate]="{value:'*', params:{ y:'200px', delay:'400ms' }}" fxLayout="row" fxLayoutWrap="wrap"  style="overflow-x: scroll !important; width: 102% !important; height: 100% !important;" (scroll)="createTable()">
                
                <div fxLayout="row" fxLayoutWrap="wrap">
                  <div fxLayout="column" fxFlex="100" fxFlex.gt-md="100">
                    <div class="hot-container full-width">
                      <hot-table id="scroll-area" [hotId]="hotId" [settings]="tableSettings"></hot-table>
                    </div>
  
                    <div class="table-foot" >
                      <div class="mb-1">
                        <button mat-raised-button 
                        class="mat-bg-success" 
                        (click)="addNewRow()">
                        Add Row</button>

                        <button mat-raised-button 
                        color="primary" 
                        (click)="saveAllData()">Save All Changes
                        </button>
                      </div>
                      <span fxFlex></span>
                    
                      <button class="paginate" matTooltip="Prev Page" 
                      (click)="navigateToPrevPage(data?._id)" 
                      [hidden]="!paginatedData.pre_page">
                      <i class="fa fa-chevron-left"></i>
                      </button> 
  
                      <button class="paginate" matTooltip="Next Page" 
                      (click)="navigateToNextPage(data?._id)"
                      [hidden]="!paginatedData?.next_page">
                        <i class="fa fa-chevron-right"></i> 
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
      </div>

      <br><br>
    </mat-tab>
  
    <!-- Categorize Your Data -->
    <mat-tab label="Categorize Your Data">
      <div fxLayout="row" fxLayoutWrap="wrap">
        <!-- Column 1 -->
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="50" [@animate]="{value:'*', params:{ y:'200px', delay:'400ms' }}"  >
          <mat-card>
            <mat-card-header>
              <mat-card-title class="mat-color-primary">
                <span>Category Creator</span>
              </mat-card-title>
              <mat-card-subtitle>
                <p>Lorem ipsum dolor sit amet, et vel error viris democritum, ei duo sumo tota albucius. Sumo atqui ut eam, mel recteque omittantur definitionem et, meliore intellegebat an cum. Vim falli insolens persequeris no. Eu pri aeque semper, dicunt malorum reprehendunt ex mea, viderer inimicus vim ne. Cu causae impetus eam, et atqui tibique consectetuer nam, in erroribus incorrupte vim. Ea voluptua eloquentiam has.</p>
              </mat-card-subtitle>
            </mat-card-header>
            <mat-divider></mat-divider>
            <br>
            <mat-card-content>
              <table mat-table #categoryTable [dataSource]="dataSource">
                <!--- Note that these columns can be defined in any order.
                      The actual rendered columns are set as a property on the row definition" -->
  

                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef> Name </th>
                  <td mat-cell *matCellDef="let category"> {{category.name}} </td>
                </ng-container>
  
                <ng-container matColumnDef="type">
                  <th mat-header-cell *matHeaderCellDef> Type </th>
                  <td mat-cell *matCellDef="let category"> {{category.type}} </td>
                </ng-container>
  
                <ng-container matColumnDef="expression">
                  <th mat-header-cell *matHeaderCellDef> Expression </th>
                  <td mat-cell *matCellDef="let category"> {{category.expression}} </td>
                </ng-container>
  
                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef> Action </th>
                  <td mat-cell *matCellDef="let category;" width="100px">
                      <mat-icon class="text-muted icon-sm" 
                      (click)="openQueryDialog('Edit Category', data, true, category.name)">
                      edit</mat-icon> 
                      <mat-icon class="text-muted icon-sm"
                      (click)="openQueryDialog('Delete Category', data, true, category.name)">
                      delete</mat-icon>
                  </td>
                </ng-container>
  
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </mat-card-content>
            <br>
            <mat-card-actions>
              <button (click)="openQueryDialog('Create Category', data)"
                mat-raised-button
                class="mat-bg-success query-category">
                Add Category
              </button>
              <span fxFlex></span>
              <p class="text-muted query-category-text">
                Category Remaining: {{ categoryRemaining || 0 }}<br>
                SubCategory Remaining: {{ subcategoryRemaining || 0 }}
              </p>
            </mat-card-actions>
          </mat-card>
          <div class="m-333" fxLayout="row" fxLayoutWrap="wrap" >
            <span fxFlex></span>
            <button mat-raised-button color="primary" 
            (click)="openQueryDialog('Test Category', data)" >
            Test Category
            </button>
          </div>
        </div>
        <!-- Column2 -->
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="50" [@animate]="{value:'*', params:{ y:'200px', delay:'400ms' }}">
          <!-- Doughnut Chart -->
          <div fxLayout="row" fxLayoutWrap="wrap" >
            <!-- Doughnut Chart para Categorias -->
            <div fxFlex="100" fxFlex.gt-sm="50">
              <mat-card class="p-0  doughnut-card">
                <mat-card-header>
                  <mat-card-title class="mat-color-primary">
                    <span>Category Mentions</span>
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <!-- Doughnut Chart para Categorias -->
                  <canvas 
                    baseChart 
                    class="chart"
                    id="categoryRemain"
                    [data]="[categoryUsed, categoryRemaining]"
                    [labels]="doughnutChartCategoryLabels"
                    [options]="doughnutOptions"
                    [colors]="doughnutChartColors"
                    [chartType]="doughnutChartType"></canvas>
                </mat-card-content>
              </mat-card>
            </div>
            <!-- Doughnut Chart para SubCategorias -->
            <div fxFlex="100" fxFlex.gt-sm="50">
              <mat-card class="p-0 doughnut-card">
                  <mat-card-header>
                    <mat-card-title class="mat-color-primary">
                      <span>SubCategory Mentions</span>
                    </mat-card-title>
                  </mat-card-header>
                <mat-card-content>
                  <!-- Doughnut Chart para SubCategorias -->
                  <canvas 
                    baseChart 
                    class="chart"
                    [data]="[subCategoryUsed, subcategoryRemaining]"
                    [labels]="doughnutChartSubCategoryLabels"
                    [options]="doughnutOptions"
                    [colors]="doughnutChartColors"
                    [chartType]="doughnutChartType"></canvas> 
                </mat-card-content>
              </mat-card>
            </div>            
          </div>
          <!-- Result Preview -->
          <div style="position: -webkit-sticky; position: sticky;top: 0;" fxLayout="row" fxLayoutWrap="wrap" >
            <div fxLayout="column" fxFlex="100" fxFlex.gt-sm="100" [@animate]="{value:'*', params:{ y:'200px', delay:'400ms' }}">
              <mat-card>
                <mat-card-title>
                  <h3 class="mat-h3 mat-color-primary">Results</h3>
                </mat-card-title>
                <mat-divider></mat-divider>
                <mat-card-content>
                  <table mat-table [dataSource]="dataSource">
                    <!--- Note this table dataSource should be fetched with real data from the backend service -->
                    <ng-container matColumnDef="content">
                      <th mat-header-cell *matHeaderCellDef> Content </th>
                      <td mat-cell *matCellDef="let category"> {{category.name}} </td>
                    </ng-container>
      
                    <ng-container matColumnDef="category">
                      <th mat-header-cell *matHeaderCellDef> Category </th>
                      <td mat-cell *matCellDef="let category"> {{category.type}} </td>
                    </ng-container>
      
                    <ng-container matColumnDef="subCategory">
                      <th mat-header-cell *matHeaderCellDef> SubCategory </th>
                      <td mat-cell *matCellDef="let category"> {{category.expression}} </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="resultsTableColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: resultsTableColumns;"></tr>
                  </table>
                </mat-card-content>


                <mat-card-content *ngIf="testCategory">
                  <mat-divider>
                    
                  </mat-divider>   
                  <br>
                  <p>Result from Test Category: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                </mat-card-content>
              </mat-card>


            </div>   

            
          </div>    
        </div>


        <div fxLayout="column" fxFlex="100">
          <div>
            <br>
            <mat-divider></mat-divider>  
            <br>
            <div>
              <span fxFlex></span>
              <button 
              (click)="cancelChanges()" 
              mat-raised-button class="mb-05">
              Back</button>

              <button 
              (click)="openQueryDialog('Save Categories', data)" 
              mat-raised-button 
              class="mb-05" color="primary">
              Save Categories</button>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
  
    <!-- Process Your Results -->
    <mat-tab label="Process Your Data">
      <!-- Credits -->
      <br>
      <div fxLayout="row" fxLayoutWrap="wrap" *ngIf="loggedInUser && data">
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="100"
          [@animate]="{value:'*', params:{ y:'200px', delay:'400ms' }}">
          <div>
            <span fxFlex></span>
            <button mat-raised-button class="mat-color-green" [routerLink]="['/products/mentions-credit']">Buy More</button>
          </div>
          <div class="mt-1 mr-1">
            <span fxFlex></span>
            <h3 class="mat-h3">Credits Remaining:<span class="credits"> ${{creditRemaining}}</span></h3>
          </div>
        </div>
      </div>

      <!-- Process Data List Options -->
      <div *ngIf="loggedInUser && data">
        <!-- Process Data List Options -->
        <div class="product-container list-view"  
        [@animate]="{value:'*', params:{ y:'200px', delay:'700ms' }}">
          <!-- Algorithm Box -->
          <div class="product-wrap" *ngFor="let algorithms of databoxAlgorithm">
            <div class="product-inner default-bg">
              <div class="relative p-1">
                <div class="allign-middle" >
                  <mat-slide-toggle color="primary" class="" 
                    [checked]="algorithms.display_text === 'Sentiment' ? sentiment 
                    : algorithms.display_text === 'Topic Recognition' ? topicRecognition
                    : algorithms.display_text === 'Entity Recognition'  ? entityRecognition
                    : algorithms.display_text === 'Gender Author' ? genderAuthor : ''"
                    
                    (change)="clickSlideToggle({
                      '_id': algorithms._id, 
                      'algorithm': algorithms.display_text
                    })">
                  </mat-slide-toggle><br>
                </div>
              </div>  
              <div class="info-wrap p-1">
                <div class="main-info main-info-prcs-data mb-0">
                 <mat-card-header>
                     <mat-card-title class="mat-color-primary">
                       <span class="algorithm-header">{{algorithms.display_text}}</span>
                     </mat-card-title>
                   </mat-card-header>
                    <p style="text-align: justify;" class="mb-0">
                      {{algorithms.description}}
                    </p><br>
                    <mat-divider></mat-divider><br>
                   <div>
                      <div>
                        <h2 class="mat-h4 mb-0">Cost / Mention: ${{algorithms?.price.sale}}</h2>
                      </div>
                      <span fxFlex></span>
                      <a class="apply mat-color-primary" (click)="openAlgorithmDialog('Apply Enrichment', sentiment, 'algorithms.display_text')"> Apply only to unprocessed data
                      </a>
                   </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <!-- FAQ's -->
      <div fxLayout="row" fxLayoutWrap="wrap" class="faq" 
        *ngIf="data?.databox_name && paginatedData"
        [@animate]="{value:'*', params:{ y:'200px', delay:'400ms' }}">
      
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="100">
          <h1 class="mat-h2 faq-header">Frequently Asked Questions</h1>
        </div>
      
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="50">
          <div class="faq-inner">
            <h2 class="mat-h3 mat-color-primary">Apply Automatically</h2>
            <p>
              Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum. Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum.
            </p>
          </div>
        </div>
      
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="50">
          <div class="faq-inner">
            <h2 class="mat-h3 mat-color-primary">Apply to Unprocessed Data</h2>
            <p>
              Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum. Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum.
            </p>
          </div>
        </div>
      
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="50">
          <div class="faq-inner">
            <h2 class="mat-h3 mat-color-primary">Cost / Mention</h2>
            <p>
              Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum. Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum.
            </p>
          </div>
        </div>
      
        <div fxLayout="column" fxFlex="100" fxFlex.gt-md="50">
          <div class="faq-inner">
            <h2 class="mat-h3 mat-color-primary">How to buy credit</h2>
            <p>
              Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum. Lorem ipsum dolor sit amet, veri modus conceptam mel cu, has in dictas discere qualisque, saperet ullamcorper ad eum.
            </p>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>



  <!-- Second Table 
  <div fxLayout="row" fxLayoutWrap="wrap" [hidden]="data?.first_create">
    <div [@animate]="{value:'*', params:{ y:'200px', delay:'400ms' }}">
      <div style="width: 101% !important;">
        <mat-card class="p-0 table-mat-card" style="width: 101% !important;">
          <mat-card-content class="table-mat-card-content">
            <table mat-table [dataSource]="databoxSecondTable">
  
              <ng-container matColumnDef="name">
                <th class="mat-header-cell-databox" mat-header-cell *matHeaderCellDef style="padding-left: 15px !important;"> Date </th>
                <td mat-cell *matCellDef="let databoxes"> {{databoxes.date}} </td>
              </ng-container>

              <ng-container matColumnDef="type">
                <th class="mat-header-cell-databox" mat-header-cell *matHeaderCellDef style="width: 600px !important; "> Content </th>
                <td mat-cell *matCellDef="let databoxes"> {{databoxes.content}} </td>
              </ng-container>
  
              <ng-container matColumnDef="expression">
                <th class="mat-header-cell-databox" mat-header-cell *matHeaderCellDef> Parent </th>
                <td mat-cell *matCellDef="let databoxes"> {{databoxes.parent}} </td>
              </ng-container>
  
              <ng-container matColumnDef="action">
                <th class="mat-header-cell-databox" mat-header-cell *matHeaderCellDef> Author </th>
                <td mat-cell *matCellDef="let databoxes"> {{databoxes.author}} </td>
              </ng-container>
  
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
  
            <mat-paginator [pageSizeOptions]="[20, 30, 50, 100]"></mat-paginator>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>-->